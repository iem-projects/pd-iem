language: c
sudo: true
## 'os' selection needs to be enabled manually by emailing travis-ci
os:
- linux
- osx
before_install:
- mkdir -p $(pwd)/build
- "./kitchen/ingredients.sh"
- make -C build -f $(pwd)/kitchen/cook DESTDIR=$(pwd)/dist TARGETOS=$(./kitchen/mangle_os.sh ${TRAVIS_OS_NAME}) PDDIR=$(pwd)/build/pd/ PDINCLUDE=$(pwd)/build/pd/src depends
script:
- make -C build -f $(pwd)/kitchen/cook DESTDIR=$(pwd)/dist TARGETOS=$(./kitchen/mangle_os.sh ${TRAVIS_OS_NAME}) PDDIR=$(pwd)/build/pd/ PDINCLUDE=$(pwd)/build/pd/src build install
deploy:
  provider: releases
  api_key:
    secure: M3LgNguw7chsEhBJnrkGB+CB2EWRYVkdO0zhXbzlXFBaIgjGzK5E5JWxKC1NoGqm/EmX9wQQgEtDn70C04Q9qHYjzws3g4BDAT8GKeByVaZdooAGCdzNFLp6IfdaRGEgwhj5+4ayDhQ6ongrh7CupUmMvRAePMjF9xExuwFFFPQ=
  file: dist/pd-iem_${TRAVIS_OS_NAME}.zip
  on:
    repo: iem-projects/pd-iem
    tags: true
